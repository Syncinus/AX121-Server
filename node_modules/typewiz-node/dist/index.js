"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require('util.promisify/shim')(); // tslint:disable-line:no-var-requires
const path = require("path");
const tsnode = require("ts-node");
const typewiz = require("typewiz-core");
const type_collector_snippet_1 = require("typewiz-core/dist/type-collector-snippet");
const nodeRegister = require("./node-register");
function getCollectedTypes() {
    return type_collector_snippet_1.$_$twiz.get();
}
exports.getCollectedTypes = getCollectedTypes;
function register(options = {}) {
    const configurationParser = new typewiz.ConfigurationParser();
    const typewizConfigPath = options && options.typewizConfig
        ? path.resolve(options.typewizConfig)
        : configurationParser.findConfigFile(process.cwd());
    if (typewizConfigPath) {
        configurationParser.parseSync(typewizConfigPath);
    }
    nodeRegister.register({ typewizConfig: typewizConfigPath });
    tsnode.register(options.tsNode);
    if (options.applyOnExit !== false) {
        process.on('exit', () => {
            typewiz.applyTypes(getCollectedTypes(), configurationParser.getApplyTypesOptions());
        });
    }
}
exports.register = register;
//# sourceMappingURL=index.js.map